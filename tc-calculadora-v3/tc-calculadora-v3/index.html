<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Endeudamiento (TC real)</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <span class="logo">üí≥</span>
        <div>
          <div class="title">Calculadora de Endeudamiento</div>
          <div class="subtitle">TC real ‚Ä¢ pagos ‚Ä¢ inter√©s diario ‚Ä¢ amortizaci√≥n</div>
        </div>
      </div>
      <button id="btnSettings" class="ghost" aria-label="Configuraci√≥n">‚öôÔ∏è</button>
    </div>
  </header>

  <!-- SETTINGS DRAWER -->
  <aside id="settingsDrawer" class="drawer" aria-hidden="true">
    <div class="drawer-head">
      <strong>Configuraci√≥n</strong>
      <button id="closeSettings" class="ghost">‚úñ</button>
    </div>

    <div class="drawer-body">
      <div class="grid2">
        <label>
          Cupo total
          <input type="text" id="cupoTotal" inputmode="numeric" placeholder="0" />
        </label>

        <label>
          Tasa E.A. (%) (efectiva anual)
          <input type="number" id="tasaEA" value="40" min="0" step="0.01" />
        </label>

        <label>
          D√≠a de corte
          <input type="number" id="diaCorte" min="1" max="31" value="25" />
        </label>

        <label>
          D√≠a de pago
          <input type="number" id="diaPago" min="1" max="31" value="5" />
        </label>

        <label>
          Pago m√≠nimo (% del estado)
          <input type="number" id="pagoMinPct" min="1" max="50" step="0.5" value="5" />
        </label>

        <label>
          Pago m√≠nimo fijo (COP)
          <input type="text" id="pagoMinFijo" inputmode="numeric" placeholder="50000" />
        </label>
      </div>

      <button id="guardarConfig">Guardar</button>
      <p class="hint">
        Inter√©s diario con tasa EA (base 365). Si NO pagas el total del estado antes del vencimiento,
        el siguiente per√≠odo acumula inter√©s diario sobre el saldo.
      </p>
    </div>
  </aside>

  <main class="app">
    <!-- RESUMEN -->
    <section class="screen active" data-screen="resumen">
      <div class="card">
        <h2>Resumen</h2>

        <div class="kpiGrid">
          <div class="kpi">
            <div class="kpiLabel">Estado de cuenta (saldo al corte)</div>
            <div class="kpiValue" id="kpiEstado">$0</div>
            <div class="kpiSub" id="kpiCiclo">‚Äî</div>
          </div>

          <div class="kpi">
            <div class="kpiLabel">Pagos a tiempo</div>
            <div class="kpiValue" id="kpiPagos">$0</div>
            <div class="kpiSub" id="kpiPagoHasta">‚Äî</div>
          </div>

          <div class="kpi">
            <div class="kpiLabel">Saldo financiado</div>
            <div class="kpiValue" id="kpiFinanciado">$0</div>
            <div class="kpiSub">Estado - pagos a tiempo</div>
          </div>

          <div class="kpi">
            <div class="kpiLabel">Inter√©s del pr√≥ximo per√≠odo</div>
            <div class="kpiValue" id="kpiInteres">$0</div>
            <div class="kpiSub" id="kpiInteresInfo">‚Äî</div>
          </div>

          <div class="kpi">
            <div class="kpiLabel">Pago m√≠nimo sugerido</div>
            <div class="kpiValue" id="kpiMinimo">$0</div>
            <div class="kpiSub">Configurable</div>
          </div>

          <div class="kpi">
            <div class="kpiLabel">Cr√©dito disponible</div>
            <div class="kpiValue" id="kpiDisponible">$0</div>
            <div class="kpiSubRow">
              <span id="badgeRiesgo" class="badge warn">‚Äî</span>
              <span id="kpiUso" class="mini">0%</span>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <h3 class="h3">Simulaci√≥n: pagar m√≠nimo vs pagar total</h3>
        <div class="simGrid">
          <div class="simBox">
            <div class="simTitle">Pago total</div>
            <div class="simLine">Inter√©s pr√≥ximo: <strong id="simTotalInteres">$0</strong></div>
            <div class="simLine">Saldo a financiar: <strong id="simTotalFin">$0</strong></div>
          </div>
          <div class="simBox">
            <div class="simTitle">Pago m√≠nimo</div>
            <div class="simLine">Inter√©s pr√≥ximo: <strong id="simMinInteres">$0</strong></div>
            <div class="simLine">Saldo a financiar: <strong id="simMinFin">$0</strong></div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Gr√°ficos</h2>
        <canvas id="chartDeudaEntidad" height="220"></canvas>
        <p class="hint">Distribuci√≥n de gastos por entidad.</p>
        <div class="divider"></div>
        <canvas id="chartTimeline" height="220"></canvas>
        <p class="hint">Pagos proyectados por mes (12 meses) para cuotas + inter√©s estimado TC (si aplica).</p>
      </div>
    </section>

    <!-- GASTOS -->
    <section class="screen" data-screen="gastos">
      <div class="card">
        <h2>Agregar gasto</h2>

        <div class="grid2">
          <label>Entidad
            <input type="text" id="entidadGasto" placeholder="Banco / Addi / etc." />
          </label>

          <label>Tipo
            <select id="tipoGasto">
              <option value="revolving">Tarjeta (revolving)</option>
              <option value="cuotas_sin_interes">Cuotas sin inter√©s</option>
              <option value="cuotas_con_interes">Cuotas con inter√©s</option>
            </select>
          </label>

          <label>Monto
            <input type="text" id="montoGasto" inputmode="numeric" placeholder="0" />
          </label>

          <label>Fecha de compra
            <input type="date" id="fechaGasto" />
          </label>

          <label>Cuotas
            <input type="number" id="cuotasGasto" value="1" min="1" />
          </label>

          <label>Tasa mensual (%) (solo cuotas con inter√©s)
            <input type="number" id="tasaMensualGasto" value="0" min="0" step="0.01" />
          </label>
        </div>

        <button id="agregarGasto">Agregar</button>
        <p class="hint">Montos con separadores de miles autom√°ticamente.</p>
      </div>

      <div class="card">
        <h2>Lista de deudas</h2>
        <div class="tableWrap">
          <table id="tablaDeudas">
            <thead>
              <tr>
                <th>Entidad</th>
                <th>Tipo</th>
                <th>Monto</th>
                <th>Cuotas</th>
                <th>Tasa</th>
                <th>Cuota mes</th>
                <th>Saldo restante</th>
                <th>Cuotas pagadas</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="cardsDeudas" class="cards"></div>
      </div>
    </section>

    <!-- PAGOS -->
    <section class="screen" data-screen="pagos">
      <div class="card">
        <h2>Registrar pago</h2>
        <div class="grid2">
          <label>Monto pago
            <input type="text" id="montoPago" inputmode="numeric" placeholder="0" />
          </label>
          <label>Fecha de pago
            <input type="date" id="fechaPago" />
          </label>
        </div>
        <button id="agregarPago">Agregar pago</button>
        <p class="hint">Los pagos se aplican al saldo m√°s antiguo primero (FIFO).</p>
      </div>

      <div class="card">
        <h2>Historial de pagos</h2>
        <div class="tableWrap">
          <table id="tablaPagos">
            <thead>
              <tr><th>Fecha</th><th>Monto</th><th>Acciones</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="cardsPagos" class="cards"></div>
      </div>
    </section>

    <!-- SIMULADOR -->
    <section class="screen" data-screen="simulador">
      <div class="card">
        <h2>Simulador de gasto</h2>

        <div class="grid2">
          <label>Entidad
            <input type="text" id="entidadSimulada" placeholder="Entidad o banco" />
          </label>

          <label>Tipo
            <select id="tipoSimulado">
              <option value="revolving">Tarjeta (revolving)</option>
              <option value="cuotas_sin_interes">Cuotas sin inter√©s</option>
              <option value="cuotas_con_interes">Cuotas con inter√©s</option>
            </select>
          </label>

          <label>Monto simulado
            <input type="text" id="montoSimulado" inputmode="numeric" placeholder="0" />
          </label>

          <label>Cuotas
            <input type="number" id="cuotasSimuladas" value="1" min="1" />
          </label>

          <label>Tasa mensual (%) (solo cuotas con inter√©s)
            <input type="number" id="tasaSimulada" value="0" min="0" step="0.01" />
          </label>

          <label>Fecha simulada
            <input type="date" id="fechaSimulada" />
          </label>
        </div>

        <button id="simular">Simular</button>
        <pre id="resultadoSimulacion" class="result"></pre>
      </div>
    </section>

    <!-- HISTORIAL -->
    <section class="screen" data-screen="historial">
      <div class="card wide">
        <h2>Amortizaci√≥n hist√≥rica (mes a mes)</h2>
        <p class="hint">Cada fila representa un ciclo: saldo al corte, pagos hasta vencimiento e inter√©s si no pagaste completo.</p>
        <div class="tableWrap">
          <table id="tablaHistorial">
            <thead>
              <tr>
                <th>Corte</th><th>Vence</th><th>Saldo al corte</th><th>Pagos a tiempo</th><th>¬øPag√≥ total?</th><th>Inter√©s del per√≠odo</th><th>Saldo post-pago</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="cardsHistorial" class="cards"></div>
      </div>
    </section>
  </main>

  <nav class="bottomNav" aria-label="Navegaci√≥n">
    <button class="navBtn active" data-go="resumen">üè†<span>Resumen</span></button>
    <button class="navBtn" data-go="gastos">üßæ<span>Gastos</span></button>
    <button class="navBtn" data-go="pagos">üí∏<span>Pagos</span></button>
    <button class="navBtn" data-go="simulador">üß™<span>Simular</span></button>
    <button class="navBtn" data-go="historial">üìö<span>Historial</span></button>
  </nav>

  <script type="module" src="js/app.js"></script>
</body>
</html>
